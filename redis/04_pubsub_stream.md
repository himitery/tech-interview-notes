# Pub/Sub & Stream

## ✅ Pub/Sub이란?

**Pub/Sub**(Publish/Subscribe)는 메시지를 **발행자**(Publisher)가 보내면, 해당 채널을 구독한 **구독자**(Subscriber)가 이를 실시간으로 받아보는 **비동기 메시징 방식**입니다.

- Redis는 채널 기반의 단순한 Pub/Sub 기능을 제공합니다.
- 상태 저장이 없고, 메시지를 받지 못하면 유실됩니다.

```bash
# 발행자
PUBLISH news "New article released!"

# 구독자
SUBSCRIBE news
```

## ✅ Pub/Sub 특징

| 항목          | 설명                                         |
| ------------- | -------------------------------------------- |
| 메시지 영속성 | ❌ 없음 (서버는 메시지 상태를 기억하지 않음) |
| 순서 보장     | ❌ 약함 (구독자가 늦게 연결하면 유실)        |
| 소비자 그룹   | ❌ 없음                                      |
| 사용 용도     | 간단한 실시간 알림, 채팅 등                  |

> [!WARNING]
> 구독 중 Redis 연결이 끊기면, 중간 메시지는 복구 불가

## ✅ Redis Stream이란?

Redis 5.0부터 추가된 **로그형 데이터 구조**로, **시간순 메시지를 안정적으로 저장 및 처리**할 수 있습니다.
Kafka의 일부 기능을 대체할 수 있을 정도로 강력한 기능을 갖추고 있습니다.

- 각 메시지에 ID가 붙으며, 메시지를 저장하고 소비 가능
- **소비자 그룹**을 통한 메시지 분산 처리 가능

```bash
# 메시지 추가
XADD mystream * user "Alice" message "Hello"

# 메시지 조회
XREAD COUNT 2 STREAMS mystream 0
```

## ✅ Stream vs Pub/Sub 비교

| 항목             | Pub/Sub           | Stream                        |
| ---------------- | ----------------- | ----------------------------- |
| 메시지 영속성    | ❌ 없음           | ✅ 있음                       |
| 메시지 조회      | ❌ 불가           | ✅ 가능 (ID 기반 조회)        |
| 소비자 그룹      | ❌ 없음           | ✅ 있음 (XGROUP 사용)         |
| 메시지 순서 보장 | ❌ 약함           | ✅ 보장                       |
| 메시지 유실 여부 | 연결 끊기면 유실  | 디스크에 저장되므로 유실 없음 |
| 적합한 사용처    | 실시간 알림, 채팅 | 로그 수집, 안정적 이벤트 처리 |

## ✅ Stream 주요 명령어

```bash
# Stream 생성 및 메시지 추가
XADD mystream * user "Bob" message "Hi"

# 단순 메시지 읽기
XREAD COUNT 1 STREAMS mystream 0

# 소비자 그룹 생성
XGROUP CREATE mystream group1 0 MKSTREAM

# 그룹으로 메시지 읽기
XREADGROUP GROUP group1 consumer1 STREAMS mystream >

# 메시지 처리 완료 표시
XACK mystream group1 1684932457163-0
```

> [!NOTE]
> 메시지 ID는 Redis가 자동 생성하며, `-0`, `-1` 형태로 처리 상태 추적

## ✅ Kafka와의 비교

| 항목             | Redis Stream                 | Kafka                   |
| ---------------- | ---------------------------- | ----------------------- |
| 메시지 저장 방식 | 메모리+디스크                | 디스크 중심 로그 저장   |
| 분산 처리        | ❌ 기본 기능 없음            | ✅ 브로커 클러스터 기반 |
| 메시지 순서      | ✅ 단일 Stream 내 순서 보장  | ✅ 파티션 내 순서 보장  |
| 대용량 처리 성능 | 적절                         | 매우 우수               |
| 사용 난이도      | 낮음                         | 높음                    |
| 사용 용도        | 마이크로서비스, 로그 처리 등 | 대규모 이벤트 스트리밍  |

> [!NOTE]
> Redis Stream은 Kafka보다 가볍고, 실시간 메시징이 필요한 내부 시스템에 적합

## ✅ 실무에서 선택 기준

| 상황                                 | 추천 기술             |
| ------------------------------------ | --------------------- |
| 단순한 실시간 알림 또는 채팅         | Redis Pub/Sub         |
| 메시지를 저장하고 나중에 재처리 필요 | Redis Stream          |
| 대용량 로그 및 이벤트 처리 필요      | Kafka                 |
| 소비자 간 메시지 분산 및 유실 방지   | Redis Stream or Kafka |
